# 필드 동기화 - 동시성 문제

- 잘 만든 로그 추적기를 실제 서비스에 배포했다 가정해보자.
- 테스트 할 때는 문제가 없는 것 처럼 보인다.
- ``FieldLogTrace``는 심각한 동시성 문제를 가지고 있다.

### 동시성 문제 확인

- 다음 로직을 1초 안에 2번 실행해보자.
- http://localhost:8080/v3/request?itemId=hello

```text
기대한 것과 전혀 다른 문제가 발생한다. 트랜잭션ID 도 동일하고, level 도 뭔가 많이 꼬인 것 같다. 분명히 테스트 코
드로 작성할 때는 문제가 없었는데, 무엇이 문제일까?
```

동시성 문제
- ``FieldLogTrace``는 싱글톤으로 등록된 스프링 빈이다. 
- 이 객체의 인스턴스가 애플리케이션에 딱 1 존재한다는 뜻이다.
- 이렇게 하나만 있는 인스턴스의 ``FieldLogTrace.traceIdHolder``필드를 여러 쓰레드가 동시에 접근하기 때문에 문제가 발생한다.
- 실무에서 한번 나타나면 개발자를 가장 괴롭히는 문제도 바로 이러한 동시성 문제이다.