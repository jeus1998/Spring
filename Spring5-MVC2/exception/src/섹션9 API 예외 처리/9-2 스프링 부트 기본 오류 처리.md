
# ìŠ¤í”„ë§ ë¶€íŠ¸ ê¸°ë³¸ ì˜¤ë¥˜ ì²˜ë¦¬

- API ì˜ˆì™¸ ì²˜ë¦¬ë„ ìŠ¤í”„ë§ ë¶€íŠ¸ê°€ ì œê³µí•˜ëŠ” ê¸°ë³¸ ì˜¤ë¥˜ ë°©ì‹ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
- ìŠ¤í”„ë§ ë¶€íŠ¸ê°€ ì œê³µí•˜ëŠ” BasicErrorController ì½”ë“œë¥¼ ë³´ì.

### BasicErrorController 
```java
@RequestMapping(produces = MediaType.TEXT_HTML_VALUE)
public ModelAndView errorHtml(HttpServletRequest request, HttpServletResponse response) {
    HttpStatus status = getStatus(request);
    Map<String, Object> model = Collections
        .unmodifiableMap(getErrorAttributes(request, getErrorAttributeOptions(request, MediaType.TEXT_HTML)));
    response.setStatus(status.value());
    ModelAndView modelAndView = resolveErrorView(request, response, status, model);
    return (modelAndView != null) ? modelAndView : new ModelAndView("error", model);
}

@RequestMapping
public ResponseEntity<Map<String, Object>> error(HttpServletRequest request) {
    HttpStatus status = getStatus(request);
    if (status == HttpStatus.NO_CONTENT) {
        return new ResponseEntity<>(status);
    }
    Map<String, Object> body = getErrorAttributes(request, getErrorAttributeOptions(request, MediaType.ALL));
    return new ResponseEntity<>(body, status);
}
```
/error ë™ì¼í•œ ê²½ë¡œë¥¼ ì²˜ë¦¬í•˜ëŠ” errorHtml() , error() ë‘ ë©”ì„œë“œë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤
- errorHtml() : produces = MediaType.TEXT_HTML_VALUE : í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì˜ Accept í•´ë” ê°’ì´
  text/html ì¸ ê²½ìš°ì—ëŠ” errorHtml()ì„ í˜¸ì¶œí•´ì„œ viewë¥¼ ì œê³µí•œë‹¤.
- error() : ê·¸ì™¸ ê²½ìš°ì— í˜¸ì¶œë˜ê³  ResponseEntity ë¡œ HTTP Bodyì— JSON ë°ì´í„°ë¥¼ ë°˜í™˜í•œë‹¤.

ìŠ¤í”„ë§ ë¶€íŠ¸ì˜ ì˜ˆì™¸ ì²˜ë¦¬
- ì•ì„œ í•™ìŠµí–ˆë“¯ì´ ìŠ¤í”„ë§ ë¶€íŠ¸ì˜ ê¸°ë³¸ ì„¤ì •ì€ ì˜¤ë¥˜ ë°œìƒì‹œ /error ë¥¼ ì˜¤ë¥˜ í˜ì´ì§€ë¡œ ìš”ì²­í•œë‹¤. 
- BasicErrorController ëŠ” ì´ ê²½ë¡œë¥¼ ê¸°ë³¸ìœ¼ë¡œ ë°›ëŠ”ë‹¤.
  - (server.error.path ë¡œ ìˆ˜ì • ê°€ëŠ¥, ê¸°ë³¸ ê²½ë¡œ /error)

Postmanìœ¼ë¡œ ì‹¤í–‰
- GET http://localhost:8080/api/members/ex
- BasicErrorController ë¥¼ ì‚¬ìš©í•˜ë„ë¡ WebServerCustomizer ì˜ @Component ë¥¼ ì£¼ì„ì²˜ë¦¬ í•˜ì.

```json
{
    "timestamp": "2024-06-07T04:35:49.330+00:00",
    "status": 500,
    "error": "Internal Server Error",
    "path": "/api/members/ex"
}
```

ìŠ¤í”„ë§ ë¶€íŠ¸ëŠ” BasicErrorController ê°€ ì œê³µí•˜ëŠ” ê¸°ë³¸ ì •ë³´ë“¤ì„ í™œìš©í•´ì„œ ì˜¤ë¥˜ APIë¥¼ ìƒì„±í•´ì¤€ë‹¤

- ë‹¤ìŒ ì˜µì…˜ë“¤ì„ ì„¤ì •í•˜ë©´ ë” ìì„¸í•œ ì˜¤ë¥˜ ì •ë³´ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.
  - server.error.include-binding-errors=always
  - server.error.include-exception=true
  - server.error.include-message=always
  - server.error.include-stacktrace=always
- ë¬¼ë¡  ì˜¤ë¥˜ ë©”ì‹œì§€ëŠ” ì´ë ‡ê²Œ ë§‰ ì¶”ê°€í•˜ë©´ ë³´ì•ˆìƒ ìœ„í—˜í•  ìˆ˜ ìˆë‹¤. ê°„ê²°í•œ ë©”ì‹œì§€ë§Œ ë…¸ì¶œí•˜ê³ , ë¡œê·¸ë¥¼ í†µí•´ì„œ í™•ì¸í•˜ì.

### Html í˜ì´ì§€ vs API ì˜¤ë¥˜

- BasicErrorController ë¥¼ í™•ì¥í•˜ë©´ JSON ë©”ì‹œì§€ë„ ë³€ê²½í•  ìˆ˜ ìˆë‹¤.
- API ì˜¤ë¥˜ëŠ” ì¡°ê¸ˆ ë’¤ì— ì„¤ëª…í•  @ExceptionHandler ê°€ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë” ë‚˜ì€ ë°©ë²•
- ì§€ê¸ˆì€ BasicErrorControllerë¥¼ í™•ì¥í•´ì„œ JSON ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆë‹¤ ì •ë„ë¡œë§Œ ì´í•´í•´ë‘ì.
- ìŠ¤í”„ë§ ë¶€íŠ¸ê°€ ì œê³µí•˜ëŠ” BasicErrorController ëŠ” HTML í˜ì´ì§€ë¥¼ ì œê³µí•˜ëŠ” ê²½ìš°ì—ëŠ” ë§¤ìš° í¸ë¦¬í•˜ë‹¤.
  - 4xx, 5xx ë“±ë“± ëª¨ë‘ ì˜ ì²˜ë¦¬í•´ì¤€ë‹¤.
- API ì˜¤ë¥˜ ì²˜ë¦¬
  - API ë§ˆë‹¤, ê°ê°ì˜ ì»¨íŠ¸ë¡¤ëŸ¬ë‚˜ ì˜ˆì™¸ë§ˆë‹¤ ì„œë¡œ ë‹¤ë¥¸ ì‘ë‹µ ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì•¼ í•  ìˆ˜ë„ ìˆë‹¤
  - ex) íšŒì› ê´€ë ¨ API ì˜ˆì™¸ ì‘ë‹µê³¼ ìƒí’ˆ ê´€ë ¨ëœ API ì˜ˆì™¸ ì‘ë‹µì´ ì˜ˆì™¸ì— ë”°ë¼ ê·¸ ê²°ê³¼ê°€ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆë‹¤.
  - ê²°ê³¼ì ìœ¼ë¡œ ë§¤ìš° ì„¸ë°€í•˜ê³  ë³µì¡í•˜ë‹¤.

ğŸ‘Œê²°ë¡ 
- ìŠ¤í”„ë§ ë¶€íŠ¸ê°€ ì œê³µí•˜ëŠ” BasicErrorController ê¸°ëŠ¥ì€ HTML í™”ë©´ì„ ì²˜ë¦¬í•  ë•Œ ì‚¬ìš© 
- API ì˜¤ë¥˜ ì²˜ë¦¬ëŠ” @ExceptionHandler ë¥¼ ì‚¬ìš©í•˜ì.
